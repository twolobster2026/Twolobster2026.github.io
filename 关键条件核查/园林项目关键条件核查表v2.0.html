<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>园林项目关键条件核查表｜Twolobster</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
*{box-sizing:border-box;font-family:"PingFang SC","Microsoft YaHei",Arial,sans-serif;}
body{margin:0;background:#fff;color:#222;padding:32px 20px 140px;}
.container{max-width:1200px;margin:0 auto;}

header h1{font-size:26px;margin-bottom:6px;}
header .description{font-size:14px;color:#666;margin-bottom:20px;}

.project-info{
    background:#fafafa;
    border:1px solid #eee;
    border-radius:16px;
    padding:24px;
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:20px;
    margin-bottom:16px;
}
.info-item{display:flex;align-items:center;}
.info-item label{width:90px;font-size:14px;color:#444;}
.info-item input{flex:1;padding:10px;border-radius:8px;border:1px solid #ddd;}

.progress{
    display:flex;
    gap:16px;
    margin-bottom:16px;
    font-size:13px;
}
.progress span{
    padding:6px 14px;
    border-radius:999px;
    background:#f5f5f5;
}
.p-written{background:#fffde7;}
.p-oral{background:#fff3f3;}
.p-none{background:#eee;}

.table-container{
    border:1px solid #eee;
    border-radius:16px;
    overflow:auto;
}
table{width:100%;border-collapse:collapse;}
th,td{
    border:1px solid #eee;
    padding:12px;
    font-size:14px;
}
th{background:#f5f5f5;}

select,input[type="date"]{
    width:100%;
    padding:8px;
    border-radius:6px;
    border:1px solid #ccc;
}

/* ===== 原有判断颜色，完整保留 ===== */
.written-row td{background:#fffde7;}
.oral-row td{background:#fff3f3;}
.none-row td{background:#fafafa;color:#777;}

/* ===== 高风险叠加提示（不改底色） ===== */
.risk-row td:first-child{
    box-shadow: inset 4px 0 0 #f44336;
}
.risk-flag{
    margin-left:6px;
    font-size:12px;
    color:#f44336;
}

/* 按钮 */
.buttons{
    display:flex;
    justify-content:center;
    gap:16px;
    margin-top:32px;
}
.btn{
    padding:12px 28px;
    border-radius:999px;
    border:none;
    cursor:pointer;
}
.btn-reset{background:#f44336;color:#fff;}
.btn-export{background:#222;color:#fff;}
.btn-image{background:#607d8b;color:#fff;}

.footer{
    position:fixed;
    bottom:12px;
    left:50%;
    transform:translateX(-50%);
    font-size:12px;
    color:#777;
}

@media(max-width:768px){
    .project-info{grid-template-columns:1fr;}
}
</style>
</head>

<body>
<div class="container" id="capture-area">

<header>
    <h1>园林项目关键条件核查表</h1>
    <div class="description">设计准备阶段关键条件确认与风险识别工具</div>
</header>

<div class="project-info">
    <div class="info-item"><label>项目名称</label><input></div>
    <div class="info-item"><label>项目负责人</label><input></div>
    <div class="info-item"><label>制表人</label><input></div>
    <div class="info-item"><label>制表日期</label><input type="date"></div>
</div>

<div class="progress">
    <span class="p-written">✔ 书面：<b id="count-written">0</b></span>
    <span class="p-oral">⚠ 口头：<b id="count-oral">0</b></span>
    <span class="p-none">⭕ 未确认：<b id="count-none">0</b></span>
</div>

<div class="table-container">
<table id="checklist-table">
<thead>
<tr>
    <th>确认方式</th>
    <th>场地条件</th>
    <th>主要影响设计内容</th>
    <th>提供时间</th>
    <th>推荐参考法规与案例</th>
</tr>
</thead>
<tbody>
<!-- 🔴 这里原样粘贴你现有 tbody -->
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>林勘</td>
                        <td>竖向、种植、移伐、古树保护、活动场地</td>
                        <td><input type="date"></td>
                        <td>北京市绿地树木许可服务管理办法（试行）（京绿办发〔2022〕98号）、<北京市古树名木保护管理条例>实施办法（京绿办发〔2022〕22号）</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>古树名木资料</td>
                        <td>竖向、种植、活动场地、排水</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、<北京市古树名木保护管理条例>实施办法（京绿办发〔2022〕22号）、古树名木保护条例 中华人民共和国国务院令 第800号</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>植物适应性</td>
                        <td>种植</td>
                        <td><input type="date"></td>
                        <td>园林绿化用植物材料 木本苗 DB11/T 211、城市森林营建技术导则 DB11/T 1637、近自然森林经营技术规程 DB11/T 842</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>野生动物栖息地</td>
                        <td>生物多样性维护、栖息地保护、目标物种生境营造、种植、竖向、道路系统</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>土壤检测报告</td>
                        <td>种植、土壤改良</td>
                        <td><input type="date"></td>
                        <td>园林绿化用地土壤质量提升技术规程 DB11/T 1604、种植屋面工程技术规程 JGJ155/常用改良土配制、园林绿化种植土壤技术要求 DB11/T 864</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>鱼塘池底有机质检测</td>
                        <td>排气（沼气）、池底结构、防水做法</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>水源条件</td>
                        <td>给排水、灌溉</td>
                        <td><input type="date"></td>
                        <td>建筑给水排水设计标准 GB50015、绿地节水技术规范 DB11/T 1297、北京市雨水控制与利用工程设计规范 DB11/T 685</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>市政管线综合</td>
                        <td>种植、竖向、结构、给排水、灌溉</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、公园设计规范 GB 51192</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>气候条件</td>
                        <td>种植、结构</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、风力、温度、降水</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>地勘资料</td>
                        <td>建筑、结构</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、结构基础处理方式</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>文物古迹</td>
                        <td>文保范围、设计红线范围、种植、竖向、铺装</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、遗址公园设计指南 T/CECA 20027</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>地勘资料-地下水位</td>
                        <td>防水做法、抗浮措施、防冻胀措施、种植、结构</td>
                        <td><input type="date"></td>
                        <td>04规范检索_防水设计规范、项目案例分享数据库、建筑与市政工程防水通用规范 GB 55030</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>覆土绿化楼板荷载</td>
                        <td>竖向、种植、结构</td>
                        <td><input type="date"></td>
                        <td>06规范检索_屋顶绿化、项目案例分享数据库、民用建筑通用规范 GB 55031、种植屋面防水施工技术规程 DB11/T 366</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>地下覆土建筑结构范围线</td>
                        <td>竖向、种植、结构</td>
                        <td><input type="date"></td>
                        <td>06规范检索_屋顶绿化、项目案例分享数据库、民用建筑通用规范 GB 55031、种植屋面防水施工技术规程 DB11/366</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>运营要求</td>
                        <td>活动场地、建筑、给排水、电气</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>居民参与和需求调研</td>
                        <td>活动场地、种植、小品、竖向、无障碍设施、停车位、自行车棚</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>

                        <td>社区更新方案征询意见</td>
                        <td>活动场地、种植、小品、竖向、无障碍设施、停车位、自行车棚</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>自行车停车棚需求</td>
                        <td>距建筑安全距离、专用充电设施、消防设施、电气火灾监控系统、视频监控系统、材料防火、防雷及防雷击电磁脉冲措施、电动自行车充电柜与建筑防火间距、充电柜与建筑的安全出口距离</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、电动自行车停放场所防火设计标准 DB11/T 1624-2025</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>消防通道和大门</td>
                        <td>消防通道（净空、宽度、转弯半径、坡度）、大门构筑物（净空、宽度）、竖向</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、建筑防火通用规范 GB 55037-2022</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>绿建三星指标</td>
                        <td>竖向、种植</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、绿色建筑评价标准  DB11/T 825</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>海绵城市指标</td>
                        <td>竖向、雨水花园、蓄水排水、排涝</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、集雨型绿地工程设计规范 DB11/T 1436</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>应急避难</td>
                        <td>竖向、种植、建筑、活动场地、给排水、电气</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库、公园绿地应急避难功能设计规范 DB11/T 794</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>城市河湖规划条件</td>
                        <td>竖向、种植、建筑、活动场地</td>
                        <td><input type="date"></td>
                        <td>05规范检索_水利电力铁路轨道交通、项目案例分享数据库、20/50/100年一遇蓄涝水位、洪水位、正常蓄水位、设计水位、校核水位</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>城市电力线路保护区</td>
                        <td>竖向、种植、建筑、活动场地</td>
                        <td><input type="date"></td>
                        <td>05规范检索_水利电力铁路轨道交通</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>轨道交通工程安全保护区范围</td>
                        <td>竖向、水景防水构造</td>
                        <td><input type="date"></td>
                        <td>05规范检索_水利电力铁路轨道交通、项目案例分享数据库、城市轨道交通工程项目规范 GB55033、地下车站与隧道结构外边线外侧50m内</td>
                    </tr>
                    <tr>
                        <td>
                            <select class="confirmation-method" onchange="updateRowStyle(this)">
                                <option value="none">无</option>
                                <option value="written">书面提供</option>
                                <option value="oral">口头提供</option>
                            </select>
                        </td>
                        <td>地震地裂带</td>
                        <td>种植、水景、结构</td>
                        <td><input type="date"></td>
                        <td>项目案例分享数据库</td>
                    </tr>
</tbody>
</table>
</div>

<div class="buttons">
<button class="btn btn-reset" onclick="resetTable()">重置</button>
<button class="btn btn-export" onclick="exportToExcel()">导出 Excel</button>
<button class="btn btn-image" onclick="exportToImage()">导出图片</button>
</div>

</div>

<div class="footer">© Twolobster ｜ 我是李工也是涛哥 v2.0</div>

<script>
const riskKeywords = ['古树','文保','抗浮','荷载','防水','无障碍','消防','地下','水位','轨道','电力','地震'];

function updateRow(row){
    row.classList.remove('written-row','oral-row','none-row','risk-row');
    const select = row.querySelector('.confirmation-method');
    const value = select.value;

    if(value === 'written') row.classList.add('written-row');
    else if(value === 'oral') row.classList.add('oral-row');
    else row.classList.add('none-row');

    // 高风险判断（不影响原色）
    const isRisk = value !== 'written' &&
        riskKeywords.some(k => row.innerText.includes(k));

    const oldFlag = row.querySelector('.risk-flag');
    if(isRisk){
        row.classList.add('risk-row');
        if(!oldFlag){
            select.insertAdjacentHTML(
                'afterend',
                '<span class="risk-flag">⚠</span>'
            );
        }
    }else{
        if(oldFlag) oldFlag.remove();
    }
}

function updateStats(){
    let w=0,o=0,n=0;
    document.querySelectorAll('.confirmation-method').forEach(s=>{
        if(s.value==='written') w++;
        else if(s.value==='oral') o++;
        else n++;
    });
    document.getElementById('count-written').innerText = w;
    document.getElementById('count-oral').innerText = o;
    document.getElementById('count-none').innerText = n;
}

function bindAll(){
    document.querySelectorAll('#checklist-table tbody tr').forEach(row=>{
        const select = row.querySelector('.confirmation-method');
        if(select){
            select.addEventListener('change',()=>{
                updateRow(row);
                updateStats();
            });
            updateRow(row);
        }
    });
    updateStats();
}

/* =========================
   ✅ Excel 导出（新增）
========================= */
function exportToExcel(){
    const wb = XLSX.utils.book_new();
    const data = [
        ['确认方式','场地条件','主要影响设计内容','提供时间','推荐参考法规与案例']
    ];

    document.querySelectorAll('#checklist-table tbody tr').forEach(row=>{
        const cells = row.children;
        data.push([
            cells[0].querySelector('select').selectedOptions[0].text,
            cells[1].innerText.trim(),
            cells[2].innerText.trim(),
            cells[3].querySelector('input').value,
            cells[4].innerText.trim()
        ]);
    });

    const ws = XLSX.utils.aoa_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws, '关键条件核查表');

    XLSX.writeFile(wb, '园林项目关键条件核查表.xlsx');
}

/* =========================
   ✅ 图片导出（新增）
========================= */
function exportToImage(){
    const target = document.getElementById('capture-area');
    html2canvas(target, {
        scale: 2,
        backgroundColor: '#ffffff'
    }).then(canvas=>{
        const link = document.createElement('a');
        link.download = '园林项目关键条件核查表.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
}

function resetTable(){
    // 1️重置所有下拉框
    document.querySelectorAll('.confirmation-method').forEach(select=>{
        select.value = 'none';
    });

    // 2️清空所有日期
    document.querySelectorAll('#checklist-table input[type="date"]').forEach(input=>{
        input.value = '';
    });

    // 3️重新刷新每一行状态（颜色 + 风险）
    document.querySelectorAll('#checklist-table tbody tr').forEach(row=>{
        updateRow(row);
    });

    // 4️刷新统计
    updateStats();
}

window.onload = bindAll;
</script>


</body>
</html>
