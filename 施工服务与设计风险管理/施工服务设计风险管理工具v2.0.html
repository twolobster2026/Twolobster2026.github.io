<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©ç®¡ç†å·¥å…·</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.1/docx.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
/* ================== å…¨å±€ç»Ÿä¸€ï¼ˆTwolobster UIï¼‰ ================== */
*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Microsoft YaHei",sans-serif;
}

body{
    background:#f6f7f9;
    color:#333;
    line-height:1.6;
}

.container{
    max-width:1200px;
    margin:0 auto;
    padding:24px;
}

/* ================== Header ================== */
header{
    background:#ffffff;
    padding:36px 24px;
    text-align:center;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    margin-bottom:28px;
}

header h1{
    font-size:26px;
    font-weight:700;
    margin-bottom:6px;
}

header p{
    font-size:14px;
    color:#666;
}

/* ================== Tabs ================== */
.tabs{
    display:flex;
    background:#fff;
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 6px 18px rgba(0,0,0,.06);
    margin-bottom:24px;
}

.tab{
    flex:1;
    text-align:center;
    padding:16px 0;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    color:#2563eb;
    background:#eff6ff;
    transition:.25s;
}

.tab.active{
    background:#2563eb;
    color:#fff;
}

.tab:hover:not(.active){
    background:#dbeafe;
}

/* ================== Content ================== */
.content{
    background:#fff;
    border-radius:14px;
    padding:32px;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    margin-bottom:30px;
}

/* ================== Titles ================== */
.section-title{
    font-size:20px;
    font-weight:700;
    margin-bottom:22px;
    padding-left:12px;
    border-left:4px solid #2563eb;
}

/* ================== Page Titleï¼ˆé£é™©æ¸…å•ä¸“ç”¨ï¼‰ ================== */
.page-title{
    font-size:22px;
    font-weight:700;
    margin-bottom:12px;
    text-align:left;
}

.page-title-divider{
    height:1px;
    background:#e5e7eb;
    margin-bottom:24px;
}

/* ================== Forms ================== */
.form-section{
    background:#f9fafb;
    border-radius:12px;
    padding:22px;
    margin-bottom:28px;
    border-left:4px solid #2563eb;
}

/* ================== é£é™©è®°å½•é¡µï¼šåŸºæœ¬ä¿¡æ¯å¡ç‰‡ ================== */
.record-header{
    background:#f9fafb;
    border-radius:14px;
    padding:26px 28px;
    border:1px solid #e5e7eb;
    margin-top:8px;          /* ä¸è¿”å›æŒ‰é’®å½¢æˆå‘¼å¸æ„Ÿ */
    padding-bottom:20px;
    border-bottom:1px solid #eee;
    margin-bottom:28px;
}

/* æ ‡é¢˜å’Œå†…å®¹ä¹‹é—´ç•™å‡ºå±‚æ¬¡ */
.record-header .record-title{
    margin-bottom:18px;
}

/* é£é™©å†…å®¹ä¸ä¸Šæ–¹ä¿¡æ¯åŒºåˆ† */
.record-header .form-group{
    margin-top:18px;
}

.form-row{
    display:flex;
    gap:20px;
    flex-wrap:wrap;
}

.form-col{
    flex:1;
    min-width:220px;
}

.form-group{
    margin-bottom:22px;   /* âœ… ç»Ÿä¸€æ¯ä¸€ç»„è¾“å…¥é¡¹çš„å‚ç›´èŠ‚å¥ */
}

/* ğŸ‘‡ æ”¾åœ¨è¿™é‡Œéå¸¸åˆé€‚ */
.double-select{
    display:flex;
    gap:16px;
    margin-top:6px;   /* âœ… è®©â€œé£é™©äº§ç”ŸåŸå› â€æ–‡å­—ä¸é€‰æ‹©æ¡†å†æ‹‰å¼€ä¸€ç‚¹ */
}

.double-select select{
    flex:1;
}

label{
    font-size:14px;
    font-weight:600;
    margin-bottom:10px;
    display:block;
    color:#444;
}

input,select,textarea{
    width:100%;
    padding:12px 14px;
    border-radius:8px;
    border:1px solid #ddd;
    font-size:14px;
}

/* ğŸ‘‡ åœ¨è¿™é‡ŒåŠ  */
textarea{
    min-height:160px;
    resize:vertical;
    line-height:1.7;
}

input:focus,select:focus,textarea:focus{
    outline:none;
    border-color:#2563eb;
    box-shadow:0 0 0 3px rgba(37,99,235,.15);
}

/* ================== Risk List ================== */
.risk-list{
    border:1px solid #eee;
    border-radius:12px;
    overflow:hidden;
}

.risk-item{
    display:flex;
    align-items:center;
    padding:14px 18px;
    border-bottom:1px solid #eee;
    transition:.2s;
}

.risk-item:hover{
    background:#f9fafb;
}

.risk-marker{
    width:22px;
    height:22px;
    border-radius:6px;
    border:2px solid #2563eb;
    margin-right:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;


    flex-shrink: 0;   /* âœ… å…³é”®ï¼šç¦æ­¢è¢«å‹ç¼© */
}

.risk-marker.selected{
    background:#ef4444;
    border-color:#ef4444;
}

.risk-marker i{
    color:#fff;
    font-size:12px;
    display:none;
}

.risk-marker.selected i{
    display:block;
}

.risk-content{
    font-size:15px;
    font-weight:500;
    color:#2563eb;
    cursor:pointer;
}

.marked{
    background:#fee2e2;
}

.marked .risk-content{
    color:#ef4444;
    font-weight:600;
}

/* ================== Buttons ================== */
.buttons{
    display:flex;
    flex-wrap:wrap;
    gap:14px;
    justify-content:center;
    margin-top:28px;
}

/* ================== è¿”å›é£é™©æ¸…å•æŒ‰é’® ================== */
.back-button{
    display:inline-flex;
    align-items:center;
    gap:8px;

    font-size:14px;
    font-weight:600;
    color:#2563eb;

    cursor:pointer;

    margin-bottom:24px;   /* âœ… å…³é”®ï¼šæ‹‰å¼€ä¸é¡¹ç›®ä¿¡æ¯å¡ç‰‡çš„è·ç¦» */
    padding:6px 10px;
    border-radius:8px;

    transition:.2s;
}

.back-button:hover{
    background:#eff6ff;
}

.btn{
    padding:12px 26px;
    border-radius:10px;
    font-size:14px;
    font-weight:600;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:8px;
    transition:.25s;
    border:none;
}

.btn-primary{
    background:#2563eb;
    color:#fff;
}

.btn-secondary{
    background:#f3f4f6;
    color:#333;
    border:1px solid #ddd;
}

.btn:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 18px rgba(0,0,0,.12);
}

/* ================== Footer ================== */
.footer-info{
    text-align:center;
    font-size:13px;
    color:#666;
    border-top:1px solid #eee;
    padding-top:16px;
    margin-top:30px;
}

/* ================== Hidden ================== */
.hidden{display:none;}
</style>
</head>

<body>
<!-- âš ï¸ ä»¥ä¸‹ body / JS å†…å®¹ä¿æŒä½ åŸå§‹ä»£ç  100% ä¸å˜ -->
<!-- è¿™é‡Œç›´æ¥æ¥ä½ åŸæ¥çš„ body + script å³å¯ï¼ˆæ— éœ€æˆ‘å†é‡å¤ï¼‰ -->
    <div class="container">
        <header>
            <h1>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©ç®¡ç†å·¥å…·</h1>
            <p>å…¨é¢ç®¡ç†æ–½å·¥è®¾è®¡é£é™©ï¼Œæé«˜é¡¹ç›®è´¨é‡ä¸å®‰å…¨æ€§</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="risk-list">é£é™©æç¤ºæ¸…å•</div>
            <div class="tab" data-tab="risk-record">é£é™©è®°å½•</div>
        </div>
        
        <!-- é£é™©æç¤ºæ¸…å•é¡µé¢ -->
        <div id="risk-list-page" class="content">
            <h2 class="page-title">æ–½å·¥æœåŠ¡è®¾è®¡é£é™©æç¤ºæ¸…å•</h2>
            <div class="page-title-divider"></div>
            
            <div class="form-section">
                <h3>åŸºæœ¬ä¿¡æ¯</h3>
                <div class="form-row">
                    <div class="form-col">
                        <label for="project-name">é¡¹ç›®åç§°</label>
                        <input type="text" id="project-name" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°">
                    </div>
                    <div class="form-col">
                        <label for="project-leader">é¡¹ç›®è´Ÿè´£äºº</label>
                        <input type="text" id="project-leader" placeholder="è¯·è¾“å…¥è´Ÿè´£äººå§“å">
                    </div>
                    <div class="form-col">
                        <label for="form-creator">åˆ¶è¡¨äºº</label>
                        <input type="text" id="form-creator" placeholder="è¯·è¾“å…¥åˆ¶è¡¨äººå§“å">
                    </div>
                    <div class="form-col">
                        <label for="record-date">è®°å½•æ—¥æœŸ</label>
                        <input type="date" id="record-date">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>é£é™©æç¤ºæ¸…å•</h3>
                <div class="risk-list">
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">è¶…å‡ºåˆåŒçº¦å®šè®¾è®¡å†…å®¹</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">è¶…å‡ºæ‰¹å¤è®¾è®¡çº¢çº¿</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">è¶…æ‰¹å¤èµ„é‡‘è®¾è®¡å˜æ›´</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">å˜æ›´æ¯”ä¾‹è¾¾åˆ°æˆ–è¶…è¿‡10%</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">å˜æ›´ä¸æ³•è§„è§„èŒƒå†²çª</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">å˜æ›´å¢åŠ é©¿ç«™å»ºç­‘æŒ‡æ ‡</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">æœªæŒ‰ç»“æ„è®¾è®¡å›¾çº¸æ–½å·¥</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">æœªæŒ‰æ°´æ± é©³å²¸æ± åº•è®¾è®¡å›¾çº¸æ–½å·¥</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">æœªæŒ‰æ°´ç”µè®¾è®¡å›¾çº¸æ–½å·¥</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">é‡å¤§è®¾è®¡æ¡ä»¶å˜æ›´ï¼ˆåœ°å‹˜ã€æ°´æ–‡ã€è·è½½ã€ç®¡çº¿ã€è½¨é“äº¤é€šã€å¤æ ‘ï¼‰</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">å‘ç”Ÿé‡å¤§å˜æ›´ï¼ˆå‡¡æ¶‰åŠè®¾è®¡èŒƒå›´ã€è®¾è®¡æœåŠ¡å†…å®¹ã€é¡¹ç›®ä¸»è¦è®¾è®¡å†…å®¹ç­‰æ–¹é¢çš„é‡å¤§æ–¹æ¡ˆè°ƒæ•´ï¼Œå·¥ç¨‹æŠ•èµ„é¢å¢å‡é«˜äº 30 ä¸‡æˆ–é«˜äºé¡¹ç›®æŠ•èµ„5%çš„é‡å¤§æŠ•èµ„å˜åŒ–ï¼Œé‡è¦èŠ‚ç‚¹æ™¯è§‚å˜åŒ–ï¼Œé‡å¤§å®‰å…¨é£é™©æ§åˆ¶çš„å˜æ›´ä¸ºé‡å¤§æ€§å˜æ›´ã€‚ï¼‰</div>
                    </div>
                    <div class="risk-item">
                        <div class="risk-marker"><i class="fas fa-check"></i></div>
                        <div class="risk-content">è¶…å‡ºç­¾å­—æƒé™</div>
                    </div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" id="generate-word"><i class="fas fa-file-word"></i> ç”ŸæˆWordæ–‡æ¡£</button>
                <button class="btn btn-primary" id="generate-excel"><i class="fas fa-file-excel"></i> ç”ŸæˆExcelè¡¨æ ¼</button>
                <button class="btn btn-primary" id="generate-jpg"><i class="fas fa-file-image"></i> ç”ŸæˆJPGå›¾ç‰‡</button>
                <button class="btn btn-secondary" id="reset-form"><i class="fas fa-redo"></i> é‡ç½®è¡¨å•</button>
            </div>
            
            <div class="footer-info">
                <div>Â© Twolobster ï½œ æˆ‘æ˜¯æå·¥ä¹Ÿæ˜¯æ¶›å“¥ | æ•°æ®æ›´æ–°ï¼š<span id="update-time">2023-11-05 14:30:25</span>  |  v2.0</div>
            </div>
        </div>
        
        <!-- é£é™©è®°å½•é¡µé¢ -->
        <div id="risk-record-page" class="content hidden">
            <div class="back-button" id="back-to-list">
                <i class="fas fa-arrow-left"></i> è¿”å›é£é™©æ¸…å•
            </div>
            
            <div class="record-header">
                <h2 class="record-title">æ–½å·¥æœåŠ¡è®¾è®¡é£é™©è®°å½•</h2>
                <div class="form-row">
                    <div class="form-col">
                        <label for="record-project-name">é¡¹ç›®åç§°</label>
                        <input type="text" id="record-project-name">
                    </div>
                    <div class="form-col">
                        <label for="record-project-leader">é¡¹ç›®è´Ÿè´£äºº</label>
                        <input type="text" id="record-project-leader">
                    </div>
                    <div class="form-col">
                        <label for="record-form-creator">åˆ¶è¡¨äºº</label>
                        <input type="text" id="record-form-creator">
                    </div>
                    <div class="form-col">
                        <label for="record-record-date">è®°å½•æ—¥æœŸ</label>
                        <input type="date" id="record-record-date">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="risk-content">é£é™©å†…å®¹</label>
                    <input type="text" id="risk-content" readonly>
                </div>
            </div>
            
            <div class="form-section">
                <h3>é£é™©åŸå› ä¸è°ƒæ•´ä¾æ®</h3>
                <div class="form-group">
                    <label>é£é™©äº§ç”ŸåŸå› </label>
                    <div class="double-select">
                        <select id="cause-unit">
                            <option value="">è¯·é€‰æ‹©è´£ä»»å•ä½</option>
                            <option value="å»ºè®¾å•ä½">å»ºè®¾å•ä½</option>
                            <option value="æ–½å·¥å•ä½">æ–½å·¥å•ä½</option>
                            <option value="è®¾è®¡å•ä½">è®¾è®¡å•ä½</option>
                        </select>
                        <select id="cause-reason">
                            <option value="">è¯·é€‰æ‹©åŸå› ç±»å‹</option>
                            <option value="æå‡æ•ˆæœ">æå‡æ•ˆæœ</option>
                            <option value="æ§åˆ¶é€ ä»·">æ§åˆ¶é€ ä»·</option>
                            <option value="ææ–™å·¥è‰º">ææ–™å·¥è‰º</option>
                            <option value="å·¥æœŸå®‰æ’">å·¥æœŸå®‰æ’</option>
                            <option value="æ¡ä»¶å˜åŒ–">æ¡ä»¶å˜åŒ–</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="adjust-basis">è°ƒæ•´ä¾æ®</label>
                    <select id="adjust-basis">
                        <option value="">è¯·é€‰æ‹©è°ƒæ•´ä¾æ®</option>
                        <option value="ä¼šè®®çºªè¦">ä¼šè®®çºªè¦</option>
                        <option value="é¢†å¯¼è®²è¯">é¢†å¯¼è®²è¯</option>
                        <option value="å£å¤´ä¼ è¾¾">å£å¤´ä¼ è¾¾</option>
                        <option value="å…¬å‡½ä»»åŠ¡ä¹¦">å…¬å‡½ä»»åŠ¡ä¹¦</option>
                    </select>
                </div>
            </div>
            
            <div class="form-section">
                <h3>äº‹ä»¶è®°å½•</h3>
                <div class="form-group">
                    <textarea id="event-record" placeholder="è¯·è¯¦ç»†è®°å½•äº‹ä»¶å‘ç”Ÿè¿‡ç¨‹..."></textarea>
                    <div class="char-count">å·²è¾“å…¥ <span id="event-count">0</span>/400 å­—</div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>è®¾è®¡æ„è§</h3>
                <div class="form-group">
                    <textarea id="design-suggestion" placeholder="è¯·å¡«å†™è®¾è®¡å¤„ç†æ„è§..."></textarea>
                    <div class="char-count">å·²è¾“å…¥ <span id="suggestion-count">0</span>/400 å­—</div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" id="record-generate-word"><i class="fas fa-file-word"></i> ç”ŸæˆWordæ–‡æ¡£</button>
                <button class="btn btn-primary" id="record-generate-excel"><i class="fas fa-file-excel"></i> ç”ŸæˆExcelè¡¨æ ¼</button>
                <button class="btn btn-primary" id="record-generate-jpg"><i class="fas fa-file-image"></i> ç”ŸæˆJPGå›¾ç‰‡</button>
            </div>
            
            <div class="footer-info">
                <div>Â© Twolobster ï½œ æˆ‘æ˜¯æå·¥ä¹Ÿæ˜¯æ¶›å“¥ | æ•°æ®æ›´æ–°ï¼š<span id="record-update-time">2023-11-05 14:30:25</span>  |  v2.0</div>
            </div>
        </div>
    </div>
    
    <!-- é£é™©è®°å½•å¼¹çª—ï¼ˆç”¨äºä»æ¸…å•é¡µç‚¹å‡»é£é™©é¡¹æ‰“å¼€ï¼‰ -->
    <div class="risk-record-page" id="risk-record-modal">
        <div class="record-container">
            <div class="close-button" id="close-modal">
                <i class="fas fa-times"></i>
            </div>
            <!-- è¿™é‡Œçš„å†…å®¹ä¼šåœ¨JSä¸­åŠ¨æ€å¡«å…… -->
        </div>
    </div>

    <script>
        // é¡µé¢åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // æ›´æ–°æ ‡ç­¾çŠ¶æ€
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // æ˜¾ç¤ºå¯¹åº”é¡µé¢
                const tabName = tab.getAttribute('data-tab');
                document.getElementById('risk-list-page').classList.toggle('hidden', tabName !== 'risk-list');
                document.getElementById('risk-record-page').classList.toggle('hidden', tabName !== 'risk-record');
            });
        });
        
        // è¿”å›é£é™©æ¸…å•
        document.getElementById('back-to-list').addEventListener('click', () => {
            document.querySelector('.tab[data-tab="risk-list"]').click();
        });
        
        // é£é™©æ ‡è®°åŠŸèƒ½
        document.querySelectorAll('.risk-marker').forEach(marker => {
            marker.addEventListener('click', function() {
                const item = this.closest('.risk-item');
                item.classList.toggle('marked');
                this.classList.toggle('selected');
            });
        });
        
        // æ‰“å¼€é£é™©è®°å½•
        document.querySelectorAll('.risk-content').forEach(content => {
            content.addEventListener('click', function() {
                const riskText = this.textContent;
                const item = this.closest('.risk-item');
                
                // å¡«å……é£é™©è®°å½•é¡µ
                document.getElementById('risk-content').value = riskText;
                
                // ä¼ é€’åŸºæœ¬ä¿¡æ¯
                document.getElementById('record-project-name').value = document.getElementById('project-name').value;
                document.getElementById('record-project-leader').value = document.getElementById('project-leader').value;
                document.getElementById('record-form-creator').value = document.getElementById('form-creator').value;
                document.getElementById('record-record-date').value = document.getElementById('record-date').value;
                
                // æ ‡è®°å½“å‰é£é™©é¡¹
                document.querySelectorAll('.risk-item').forEach(item => {
                    item.classList.remove('current-risk');
                });
                item.classList.add('current-risk');
                
                // åˆ‡æ¢åˆ°é£é™©è®°å½•é¡µ
                document.querySelector('.tab[data-tab="risk-record"]').click();
            });
        });
        
        // é‡ç½®è¡¨å•
        document.getElementById('reset-form').addEventListener('click', function() {
            if(confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                // æ¸…ç©ºåŸºæœ¬ä¿¡æ¯
                document.getElementById('project-name').value = '';
                document.getElementById('project-leader').value = '';
                document.getElementById('form-creator').value = '';
                document.getElementById('record-date').value = '';
                
                // æ¸…é™¤æ‰€æœ‰æ ‡è®°
                document.querySelectorAll('.risk-item').forEach(item => {
                    item.classList.remove('marked');
                    item.querySelector('.risk-marker').classList.remove('selected');
                });
            }
        });
        
        // æ–‡æœ¬è¾“å…¥è®¡æ•°
        document.getElementById('event-record').addEventListener('input', function() {
            document.getElementById('event-count').textContent = this.value.length;
        });
        
        document.getElementById('design-suggestion').addEventListener('input', function() {
            document.getElementById('suggestion-count').textContent = this.value.length;
        });
        
        // æ›´æ–°æ—¶é—´ï¼ˆä»…æ˜¾ç¤ºå¹´æœˆæ—¥ï¼‰
function updateTime() {
    const now = new Date();
    const dateStr = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥`;

    document.getElementById('update-time').textContent = dateStr;
    document.getElementById('record-update-time').textContent = dateStr;
}

// åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸éœ€è¦å®šæ—¶åˆ·æ–°
updateTime();

        
        // åˆå§‹åŒ–æ—¥æœŸä¸ºä»Šå¤©
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0];
        document.getElementById('record-date').value = formattedDate;
        document.getElementById('record-record-date').value = formattedDate;
        
        // å…³é—­æ¨¡æ€æ¡†
        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('risk-record-modal').classList.remove('active');
        });
        
        // ==== æ–°å¢çš„ç”ŸæˆåŠŸèƒ½ä»£ç  ====
        
        // ç”ŸæˆWordæ–‡æ¡£ï¼ˆé£é™©æ¸…å•é¡µé¢ï¼‰
        document.getElementById('generate-word').addEventListener('click', generateWordForList);
        function generateWordForList() {
            try {
                const projectName = document.getElementById('project-name').value || 'æœªå‘½åé¡¹ç›®';
                const basicInfo = getBasicInfo();
                const riskItems = getMarkedRiskItems();
                
                const docContent = createRiskListDocContent(basicInfo, riskItems);
                const blob = new Blob([docContent], {type: 'application/msword'});
                saveAs(blob, `é£é™©æç¤ºæ¸…å•_${projectName}.doc`);
                
                alert('Wordæ–‡æ¡£ç”ŸæˆæˆåŠŸï¼Œå³å°†å¼€å§‹ä¸‹è½½');
            } catch (e) {
                console.error('ç”ŸæˆWordæ–‡æ¡£æ—¶å‡ºé”™:', e);
                alert('ç”ŸæˆWordæ–‡æ¡£æ—¶å‡ºé”™: ' + e.message);
            }
        }
        
        // ç”ŸæˆExcelè¡¨æ ¼ï¼ˆé£é™©æ¸…å•é¡µé¢ï¼‰
        document.getElementById('generate-excel').addEventListener('click', generateExcelForList);
        function generateExcelForList() {
            try {
                const projectName = document.getElementById('project-name').value || 'æœªå‘½åé¡¹ç›®';
                const basicInfo = getBasicInfo();
                const riskItems = getRiskItems();
                
                const workbook = createRiskListWorkbook(basicInfo, riskItems);
                XLSX.writeFile(workbook, `é£é™©æç¤ºæ¸…å•_${projectName}.xlsx`);
                
                alert('Excelæ–‡ä»¶ç”ŸæˆæˆåŠŸï¼Œå³å°†å¼€å§‹ä¸‹è½½');
            } catch (e) {
                console.error('ç”ŸæˆExcelæ–‡ä»¶æ—¶å‡ºé”™:', e);
                alert('ç”ŸæˆExcelæ–‡ä»¶æ—¶å‡ºé”™: ' + e.message);
            }
        }
        
        // ç”ŸæˆJPGå›¾ç‰‡ï¼ˆé£é™©æ¸…å•é¡µé¢ï¼‰
        document.getElementById('generate-jpg').addEventListener('click', generateJpgForList);
        function generateJpgForList() {
            try {
                const projectName = document.getElementById('project-name').value || 'æœªå‘½åé¡¹ç›®';
                const element = document.getElementById('risk-list-page');
                
                html2canvas(element, {
                    scale: 2,
                    useCORS: true
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    const link = document.createElement('a');
                    link.href = imgData;
                    link.download = `é£é™©æç¤ºæ¸…å•_${projectName}.jpg`;
                    link.click();
                    
                    alert('JPGå›¾ç‰‡ç”ŸæˆæˆåŠŸï¼Œå³å°†å¼€å§‹ä¸‹è½½');
                }).catch(e => {
                    console.error('ç”Ÿæˆå›¾ç‰‡æ—¶å‡ºé”™:', e);
                    alert('ç”Ÿæˆå›¾ç‰‡æ—¶å‡ºé”™: ' + e.message);
                });
            } catch (e) {
                console.error('ç”ŸæˆJPGå›¾ç‰‡æ—¶å‡ºé”™:', e);
                alert('ç”ŸæˆJPGå›¾ç‰‡æ—¶å‡ºé”™: ' + e.message);
            }
        }
        
        // ç”ŸæˆWordæ–‡æ¡£ï¼ˆé£é™©è®°å½•é¡µé¢ï¼‰
        document.getElementById('record-generate-word').addEventListener('click', generateWordForRecord);
        function generateWordForRecord() {
            try {
                const projectName = document.getElementById('record-project-name').value || 'æœªå‘½åé¡¹ç›®';
                const riskContent = document.getElementById('risk-content').value || 'æœªæŒ‡å®šé£é™©';
                
                const recordData = getRiskRecordData();
                const docContent = createRiskRecordDocContent(projectName, riskContent, recordData);
                const blob = new Blob([docContent], {type: 'application/msword'});
                saveAs(blob, `é£é™©è®°å½•_${riskContent}.doc`);
                
                alert('é£é™©è®°å½•Wordæ–‡æ¡£ç”ŸæˆæˆåŠŸï¼Œå³å°†å¼€å§‹ä¸‹è½½');
            } catch (e) {
                console.error('ç”Ÿæˆé£é™©è®°å½•Wordæ–‡æ¡£æ—¶å‡ºé”™:', e);
                alert('ç”Ÿæˆé£é™©è®°å½•Wordæ–‡æ¡£æ—¶å‡ºé”™: ' + e.message);
            }
        }
        
        // ç”ŸæˆExcelè¡¨æ ¼ï¼ˆé£é™©è®°å½•é¡µé¢ï¼‰
        document.getElementById('record-generate-excel').addEventListener('click', generateExcelForRecord);
        function generateExcelForRecord() {
            try {
                const projectName = document.getElementById('record-project-name').value || 'æœªå‘½åé¡¹ç›®';
                const riskContent = document.getElementById('risk-content').value || 'æœªæŒ‡å®šé£é™©';
                const recordData = getRiskRecordData();
                
                const workbook = createRiskRecordWorkbook(projectName, riskContent, recordData);
                XLSX.writeFile(workbook, `é£é™©è®°å½•_${riskContent}.xlsx`);
                
                alert('é£é™©è®°å½•Excelæ–‡ä»¶ç”ŸæˆæˆåŠŸï¼Œå³å°†å¼€å§‹ä¸‹è½½');
            } catch (e) {
                console.error('ç”Ÿæˆé£é™©è®°å½•Excelæ—¶å‡ºé”™:', e);
                alert('ç”Ÿæˆé£é™©è®°å½•Excelæ—¶å‡ºé”™: ' + e.message);
            }
        }
        
        // ç”ŸæˆJPGå›¾ç‰‡ï¼ˆé£é™©è®°å½•é¡µé¢ï¼‰
        document.getElementById('record-generate-jpg').addEventListener('click', generateJpgForRecord);
        function generateJpgForRecord() {
            try {
                const riskContent = document.getElementById('risk-content').value || 'æœªæŒ‡å®šé£é™©';
                const element = document.getElementById('risk-record-page');
                
                html2canvas(element, {
                    scale: 2,
                    useCORS: true
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/jpeg', 0.95);
                    const link = document.createElement('a');
                    link.href = imgData;
                    link.download = `é£é™©è®°å½•_${riskContent}.jpg`;
                    link.click();
                    
                    alert('é£é™©è®°å½•JPGå›¾ç‰‡ç”ŸæˆæˆåŠŸï¼Œå³å°†å¼€å§‹ä¸‹è½½');
                }).catch(e => {
                    console.error('ç”Ÿæˆé£é™©è®°å½•å›¾ç‰‡æ—¶å‡ºé”™:', e);
                    alert('ç”Ÿæˆé£é™©è®°å½•å›¾ç‰‡æ—¶å‡ºé”™: ' + e.message);
                });
            } catch (e) {
                console.error('ç”Ÿæˆé£é™©è®°å½•JPGå›¾ç‰‡æ—¶å‡ºé”™:', e);
                alert('ç”Ÿæˆé£é™©è®°å½•JPGå›¾ç‰‡æ—¶å‡ºé”™: ' + e.message);
            }
        }
        
        // ==== è¾…åŠ©å‡½æ•° ====
        
        // è·å–åŸºæœ¬ä¿¡æ¯
        function getBasicInfo() {
            return {
                projectName: document.getElementById('project-name').value || '',
                projectLeader: document.getElementById('project-leader').value || '',
                formCreator: document.getElementById('form-creator').value || '',
                recordDate: document.getElementById('record-date').value || ''
            };
        }
        
        // è·å–æ‰€æœ‰é£é™©é¡¹ï¼ˆå·²æ ‡è®°å’Œæœªæ ‡è®°ï¼‰
        function getRiskItems() {
            const items = [];
            document.querySelectorAll('.risk-item').forEach(item => {
                items.push({
                    content: item.querySelector('.risk-content').textContent,
                    marked: item.classList.contains('marked')
                });
            });
            return items;
        }
        
        // è·å–å·²æ ‡è®°çš„é£é™©é¡¹
        function getMarkedRiskItems() {
            const markedItems = [];
            document.querySelectorAll('.risk-item').forEach(item => {
                if (item.classList.contains('marked')) {
                    markedItems.push({
                        content: item.querySelector('.risk-content').textContent
                    });
                }
            });
            return markedItems;
        }
        
        // è·å–é£é™©è®°å½•æ•°æ®
        function getRiskRecordData() {
            return {
                projectName: document.getElementById('record-project-name').value || '',
                projectLeader: document.getElementById('record-project-leader').value || '',
                formCreator: document.getElementById('record-form-creator').value || '',
                recordDate: document.getElementById('record-record-date').value || '',
                riskContent: document.getElementById('risk-content').value || '',
                causeUnit: document.getElementById('cause-unit').value || '',
                causeReason: document.getElementById('cause-reason').value || '',
                adjustBasis: document.getElementById('adjust-basis').value || '',
                eventRecord: document.getElementById('event-record').value || '',
                designSuggestion: document.getElementById('design-suggestion').value || ''
            };
        }
        
        // åˆ›å»ºWordæ–‡æ¡£å†…å®¹ï¼ˆé£é™©æ¸…å•ï¼‰
        function createRiskListDocContent(basicInfo, riskItems) {
            let html = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                      xmlns:w="urn:schemas-microsoft-com:office:word"
                      xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="UTF-8">
                    <title>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©æç¤ºæ¸…å•</title>
                    <style>
                        body { font-family: SimSun, serif; font-size: 12pt; line-height: 1.5; }
                        h1 { text-align: center; font-size: 22pt; margin-bottom: 40px; }
                        h2 { font-size: 16pt; border-left: 5px solid #2e7d32; padding-left: 10px; margin-top: 25px; }
                        .info-table { width: 100%; border-collapse: collapse; margin-bottom: 25px; }
                        .info-table td { border: 1px solid #000; padding: 8px 12px; }
                        .info-table .title { width: 20%; font-weight: bold; background-color: #f5f5f5; }
                        .risk-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
                        .risk-table th, .risk-table td { border: 1px solid #000; padding: 10px; text-align: center; }
                        .risk-table th { background-color: #2e7d32; color: white; font-weight: bold; }
                        .footer { margin-top: 50px; text-align: right; font-size: 10pt; }
                        .marked { color: #f44336; }
                    </style>
                </head>
                <body>
                    <h1>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©æç¤ºæ¸…å•</h1>
                    
                    <h2>é¡¹ç›®åŸºæœ¬ä¿¡æ¯</h2>
                    <table class="info-table">
                        <tr>
                            <td class="title">é¡¹ç›®åç§°</td>
                            <td>${basicInfo.projectName}</td>
                            <td class="title">é¡¹ç›®è´Ÿè´£äºº</td>
                            <td>${basicInfo.projectLeader}</td>
                        </tr>
                        <tr>
                            <td class="title">åˆ¶è¡¨äºº</td>
                            <td>${basicInfo.formCreator}</td>
                            <td class="title">è®°å½•æ—¥æœŸ</td>
                            <td>${basicInfo.recordDate}</td>
                        </tr>
                    </table>
                    
                    <h2>é£é™©æç¤ºæ¸…å•</h2>
                    <table class="risk-table">
                        <thead>
                            <tr>
                                <th width="10%">åºå·</th>
                                <th width="70%">é£é™©å†…å®¹</th>
                                <th width="20%">æ˜¯å¦æ ‡è®°</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // æ·»åŠ é£é™©é¡¹
            const riskItemsData = getRiskItems();
            riskItemsData.forEach((item, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.content}</td>
                        <td${item.marked ? ' class="marked">å·²æ ‡è®°' : '>æœªæ ‡è®°'}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}</p>
                        <p>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©ç®¡ç†å·¥å…· v1.0</p>
                    </div>
                </body>
                </html>
            `;
            
            return html;
        }
        
        // åˆ›å»ºExcelå·¥ä½œç°¿ï¼ˆé£é™©æ¸…å•ï¼‰
        function createRiskListWorkbook(basicInfo, riskItems) {
            const workbook = XLSX.utils.book_new();
            
            // åˆ›å»ºåŸºæœ¬ä¿¡æ¯å·¥ä½œè¡¨
            const basicData = [
                ['æ–½å·¥æœåŠ¡è®¾è®¡é£é™©æç¤ºæ¸…å•'],
                [''],
                ['é¡¹ç›®åŸºæœ¬ä¿¡æ¯'],
                ['é¡¹ç›®åç§°', basicInfo.projectName],
                ['é¡¹ç›®è´Ÿè´£äºº', basicInfo.projectLeader],
                ['åˆ¶è¡¨äºº', basicInfo.formCreator],
                ['è®°å½•æ—¥æœŸ', basicInfo.recordDate],
                [''],
                ['é£é™©æ¸…å•åˆ—è¡¨']
            ];
            
            const basicWorksheet = XLSX.utils.aoa_to_sheet(basicData);
            XLSX.utils.book_append_sheet(workbook, basicWorksheet, "é¡¹ç›®ä¿¡æ¯");
            
            // åˆ›å»ºé£é™©æ¸…å•å·¥ä½œè¡¨
            const riskData = [['åºå·', 'é£é™©å†…å®¹', 'æ˜¯å¦æ ‡è®°']];
            riskItems.forEach((item, index) => {
                riskData.push([
                    index + 1,
                    item.content,
                    item.marked ? 'æ˜¯' : 'å¦'
                ]);
            });
            
            const riskWorksheet = XLSX.utils.aoa_to_sheet(riskData);
            XLSX.utils.book_append_sheet(workbook, riskWorksheet, "é£é™©æ¸…å•");
            
            return workbook;
        }
        
        // åˆ›å»ºWordæ–‡æ¡£å†…å®¹ï¼ˆé£é™©è®°å½•ï¼‰
        function createRiskRecordDocContent(projectName, riskContent, recordData) {
            let html = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                      xmlns:w="urn:schemas-microsoft-com:office:word"
                      xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="UTF-8">
                    <title>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©è®°å½• - ${riskContent}</title>
                    <style>
                        body { font-family: SimSun, serif; font-size: 12pt; line-height: 1.8; }
                        h1 { text-align: center; font-size: 22pt; margin-bottom: 40px; }
                        .record-header { text-align: center; margin-bottom: 30px; }
                        .record-header h2 { font-size: 18pt; color: #2e7d32; margin-bottom: 15px; }
                        .record-header .project { font-size: 16pt; margin-bottom: 10px; }
                        .risk-content { text-align: center; font-size: 16pt; color: #f44336; margin: 25px 0; padding: 15px; background-color: #ffebee; }
                        .info-section { margin-bottom: 25px; }
                        .info-section h3 { font-size: 14pt; border-bottom: 2px solid #2e7d32; padding-bottom: 5px; }
                        .info-section p { margin: 10px 0; text-indent: 2em; }
                        .signature { margin-top: 50px; text-align: right; }
                        .signature div { margin-bottom: 10px; }
                        .footer { margin-top: 80px; text-align: center; font-size: 10pt; color: #777; }
                    </style>
                </head>
                <body>
                    <h1>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©è®°å½•</h1>
                    
                    <div class="record-header">
                        <div class="project">é¡¹ç›®åç§°ï¼š${projectName}</div>
                        <div>è®°å½•æ—¥æœŸï¼š${recordData.recordDate}</div>
                    </div>
                    
                    <div class="risk-content">é£é™©å†…å®¹ï¼š${riskContent}</div>
                    
                    <div class="info-section">
                        <h3>é£é™©äº§ç”ŸåŸå› </h3>
                        <p>è´£ä»»å•ä½ï¼š${recordData.causeUnit}</p>
                        <p>åŸå› ç±»å‹ï¼š${recordData.causeReason}</p>
                    </div>
                    
                    <div class="info-section">
                        <h3>è°ƒæ•´ä¾æ®</h3>
                        <p>${recordData.adjustBasis}</p>
                    </div>
                    
                    <div class="info-section">
                        <h3>äº‹ä»¶è®°å½•</h3>
                        <p>${recordData.eventRecord}</p>
                    </div>
                    
                    <div class="info-section">
                        <h3>è®¾è®¡å¤„ç†æ„è§</h3>
                        <p>${recordData.designSuggestion}</p>
                    </div>
                    
                    <div class="signature">
                        <div>åˆ¶è¡¨äººï¼š${recordData.formCreator}</div>
                        <div>é¡¹ç›®è´Ÿè´£äººï¼š${recordData.projectLeader}</div>
                        <div>æ—¥æœŸï¼š${new Date().toLocaleDateString()}</div>
                    </div>
                    
                    <div class="footer">
                        <p>ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}</p>
                        <p>æ–½å·¥æœåŠ¡è®¾è®¡é£é™©ç®¡ç†å·¥å…· v1.0</p>
                    </div>
                </body>
                </html>
            `;
            
            return html;
        }
        
        // åˆ›å»ºExcelå·¥ä½œç°¿ï¼ˆé£é™©è®°å½•ï¼‰
        function createRiskRecordWorkbook(projectName, riskContent, recordData) {
            const workbook = XLSX.utils.book_new();
            
            // åˆ›å»ºä¸»è®°å½•å·¥ä½œè¡¨
            const mainData = [
                ['æ–½å·¥æœåŠ¡è®¾è®¡é£é™©è®°å½•', '', '', '', ''],
                ['é¡¹ç›®åç§°:', projectName, '', 'è®°å½•æ—¥æœŸ:', recordData.recordDate],
                ['é£é™©å†…å®¹:', riskContent, '', '', ''],
                [''],
                ['é£é™©äº§ç”ŸåŸå› '],
                ['è´£ä»»å•ä½', recordData.causeUnit],
                ['åŸå› ç±»å‹', recordData.causeReason],
                [''],
                ['è°ƒæ•´ä¾æ®'],
                ['ä¾æ®ç±»å‹', recordData.adjustBasis],
                [''],
                ['äº‹ä»¶è®°å½•'],
                ['äº‹ä»¶è¯¦ç»†å†…å®¹'],
                [recordData.eventRecord],
                [''],
                ['è®¾è®¡å¤„ç†æ„è§'],
                ['å¤„ç†æ„è§å†…å®¹'],
                [recordData.designSuggestion],
                [''],
                ['åˆ¶è¡¨äºº', recordData.formCreator],
                ['é¡¹ç›®è´Ÿè´£äºº', recordData.projectLeader]
            ];
            
            const mainWorksheet = XLSX.utils.aoa_to_sheet(mainData);
            XLSX.utils.book_append_sheet(workbook, mainWorksheet, "é£é™©è®°å½•");
            
            return workbook;
        }
    </script>
</body>
</html>
